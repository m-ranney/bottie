{% extends "base.html" %}

{% block content %}
  <div class="container">
    <h1>Step by Step Guide</h1>
    <form id="task-form">
      <label for="task">Enter a task:</label>
      <input type="text" name="task" id="task" required>
      <button type="submit">Submit Task</button>
    </form>
    <br>
    <!-- Table for displaying task and subtasks -->
    <table id="task-table" style="display:none;">
      <thead>
        <tr>
          <th>Task</th>
          <th>Subtask</th>
        </tr>
      </thead>
      <tbody id="task-table-body">
      </tbody>
    </table>
  </div>

  <script>
    document.getElementById("task-form").addEventListener("submit", async function (event) {
      event.preventDefault();
      const taskInput = document.getElementById("task");
      const task = taskInput.value;
      taskInput.value = "";

      const response = await fetch("/steps/api_generate_subtasks", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ task: task })
      });

      if (response.ok) {
        const data = await response.json();
        const subtasks = data.subtasks;
        const tableBody = document.getElementById("task-table-body");
        tableBody.innerHTML = "";

        for (const subtask of subtasks) {
          const row = document.createElement("tr");
          const taskCell = document.createElement("td");
          const subtaskCell = document.createElement("td");

          taskCell.textContent = task;
          subtaskCell.textContent = subtask;

          row.appendChild(taskCell);
          row.appendChild(subtaskCell);
          tableBody.appendChild(row);
        }

        document.getElementById("task-table").style.display = "table";
      } else {
        alert("Error generating subtasks. Please try again.");
      }
    });
  </script>
{% endblock %}

